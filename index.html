<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบเบิกเงิน</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
            background-color: #f4f4f4;
        }
        h2 {
            text-align: center;
        }
        form {
            max-width: 400px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        label {
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
        }
        button {
            background-color: #28a745;
            color: white;
            border: none;
            cursor: pointer;
        }
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #007bff;
            color: white;
        }
    </style>
</head>
<body>
    <h2>ระบบบันทึกการเบิกเงิน</h2>
    <form id="withdrawForm">
        <label>ชื่อ:</label>
        <input type="text" id="name" required>
        
        <label>จำนวนเงิน:</label>
        <input type="number" id="amount" required>
        
        <label>เหตุผล:</label>
        <input type="text" id="reason" required>
        
        <label>วันที่:</label>
        <input type="date" id="date" required>
        
        <button type="button" id="submitBtn">บันทึกข้อมูล</button>
    </form>

    <h2>รายการเบิกเงิน</h2>
    <table>
        <thead>
            <tr>
                <th>ชื่อ</th>
                <th>จำนวนเงิน</th>
                <th>เหตุผล</th>
                <th>วันที่</th>
            </tr>
        </thead>
        <tbody id="withdrawTableBody">
            <!-- ข้อมูลจาก API จะถูกเติมที่นี่ -->
        </tbody>
    </table>

    <script>
        // เมื่อกดปุ่มบันทึกข้อมูล
        document.getElementById("submitBtn").addEventListener("click", function () {
            const name = document.getElementById("name").value;
            const amount = document.getElementById("amount").value;
            const reason = document.getElementById("reason").value;
            const date = document.getElementById("date").value;

            if (!name || !amount || !reason || !date) {
                alert("กรุณากรอกข้อมูลให้ครบถ้วน");
                return;
            }

            fetch("http://localhost:3001/withdraw", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name, amount, reason, date }),
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                document.getElementById("withdrawForm").reset();
                fetchWithdrawals(); // โหลดข้อมูลใหม่หลังจากบันทึก
            })
            .catch(error => console.error("Error:", error));
        });

        // ดึงข้อมูลจาก API
        function fetchWithdrawals() {
            fetch("http://localhost:3001/withdrawals")
                .then(response => response.json())
                .then(data => {
                    let tableBody = document.getElementById("withdrawTableBody");
                    tableBody.innerHTML = ""; // ล้างข้อมูลเก่า
                    data.forEach(item => {
                        let row = `<tr>
                            <td>${item.name}</td>
                            <td>${item.amount}</td>
                            <td>${item.reason}</td>
                            <td>${item.date}</td>
                        </tr>`;
                        tableBody.innerHTML += row;
                    });
                })
                .catch(error => console.error("Error:", error));
        }

        // โหลดข้อมูลเมื่อเปิดหน้าเว็บ
        window.onload = fetchWithdrawals;
    </script>
</body>
</html>
